<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.Semicolon.pms.dao.CalendarDAO">
	<resultMap id="calendarMap"
		type="com.Semicolon.pms.dto.CalendarDto">
		<id property="calendarId" column="CALENDAR_ID" />
		<result property="calendarTitle" column="CALENDAR_TITLE" />
		<result property="projectId" column="PROJECT_ID" />
		<result property="calendarContent" column="CALENDAR_CONTENT" />
		<result property="calendarStartDate"
			column="CALENDAR_START_DATE" />
		<result property="calendarEndDate" column="CALENDAR_END_DATE" />
		<result property="calendarRegDate" column="CALENDAR_REG_DATE" />
		<result property="calendarModifyDate"
			column="CALENDAR_MODIFY_DATE" />
	</resultMap>

	<insert id="addCalendar"
		parameterType="com.Semicolon.pms.dto.CalendarDto">
		<selectKey keyProperty="calendarId" resultType="string"
			order="BEFORE">
			SELECT 'CAL' || LPAD(CALENDAR_SEQ.NEXTVAL, 4, '0') FROM DUAL
		</selectKey>
		INSERT INTO CALENDAR (
		CALENDAR_ID,
		CALENDAR_TITLE,
		PROJECT_ID,
		CALENDAR_CONTENT,
		CALENDAR_START_DATE,
		CALENDAR_END_DATE,
		CALENDAR_REG_DATE,
		CALENDAR_MODIFY_DATE
		) VALUES (
		#{calendarId,
		jdbcType=VARCHAR},
		#{calendarTitle, jdbcType=VARCHAR},
		#{projectId},
		#{calendarContent, jdbcType=VARCHAR},
		#{calendarStartDate,
		jdbcType=DATE},
		#{calendarEndDate, jdbcType=DATE},
		SYSDATE,
		SYSDATE
		)
	</insert>

	<select id="getAllCalendars" parameterType="string"
		resultMap="calendarMap">
		SELECT * FROM CALENDAR
		WHERE PROJECT_ID = #{projectId}
		ORDER
		BY CALENDAR_START_DATE ASC
	</select>

	<select id="getCalendarById" parameterType="map"
		resultMap="calendarMap">
		SELECT * FROM CALENDAR
		WHERE PROJECT_ID = #{projectId} AND CALENDAR_ID = #{calendarId}
	</select>
	
	<update id="updateCalendar"
		parameterType="com.Semicolon.pms.dto.CalendarDto">
		UPDATE CALENDAR
		SET
		CALENDAR_TITLE = #{calendarTitle},
		CALENDAR_CONTENT = #{calendarContent},
		CALENDAR_START_DATE =
		#{calendarStartDate},
		CALENDAR_END_DATE = #{calendarEndDate},
		CALENDAR_MODIFY_DATE = SYSDATE
		WHERE CALENDAR_ID = #{calendarId}
	</update>

	<delete id="deleteCalendar" parameterType="map">
		DELETE FROM CALENDAR
		WHERE PROJECT_ID = #{projectId}
		AND CALENDAR_ID = #{calendarId}
	</delete>
</mapper>